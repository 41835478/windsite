$(function(){function o(b,i){$("dd",u).remove();$(".related-goods-marker",j).remove();if(k!=null){for(var f,d=0;d<k.length;d++){var A=k[d];if(b==A.picId){f=A;e=d;break}}if(!(f==null||!f)){c=parseInt(e/5)*5;true==i&&e>5&&p.animate({top:-1*c*l},500);v.animate({top:l*(e-c)},500);B.unbind("load").load(function(){F.text(e+1);var w=[],n=$(this).height()<=502?508:$(this).height()+6,m;m=parseInt(j.height());if(isNaN(m))m=0;m=Math.abs(m-n);j.animate({height:n},(m>15?0.5:0.1)>15?500:1E3);n=f.markedItem;if(!(n==
null||!n||n.length==0)){G.empty().append(f.picDesc);m=$(this).width()>660?660:$(this).width();$(this).height();for(var q=0;q<n.length;q++){var a=n[q];w.push(a.itemId);var x=$('<dd style="display:none" data-tipid="'+q+'">'+a.itemTitle+"</dd>");u.append(x);x=$('<div class="related-goods-marker" style="left:'+((654-m)/2+a.x)+"px;top:"+a.y+'px" data-tipid="'+q+'"></div>');for(var y=$('<span class="marked-area" style="width:'+(a.width+8)+"px;height:"+(a.height+8)+'px;"></span>'),g=1;g<4;g++)y.append('<b class="shadow-'+
g+'" style="width:'+(a.width+(4-g)*2)+"px;height:"+(a.height+(4-g)*2)+'px;"></b>');g=$('<b class="inner-border" style="width:'+a.width+"px;height:"+a.height+'px;opacity: 1; filter:Alpha(Opacity=100);"></b>');y.append(g);g=-1*(a.height+8)/2;var r=(a.width+8)/2;g=g+a.y+270>$(this).height()?g-123:g;r=r+(654-m)/2+a.x+254>$(this).width()?r-270:r;a=$('<div class="tip-wrap" href="/titem/'+a.itemId+".html?"+a.P4PKeyword+'" style="margin-left:'+r+"px;margin-top:"+g+'px;display:none;"><b class="corner"></b><div class="goods-tip clearfix"><div class="pic goods-image"><a href="/titem/'+
a.itemId+".html?"+a.P4PKeyword+'" target="_blank"><img src="'+a.itemPic+'" /></a></div><dl class="goods-detail"><dt class="goods-name">\u5546\u54c1\u540d\u79f0:</dt><dd><a href="/titem/'+a.itemId+".html?"+a.P4PKeyword+'" target="_blank">'+a.itemTitle+'</a></dd><dt class="overwritten">\u4e00\u53e3\u4ef7:</dt><dd class="goods-price overwritten">\uffe5'+a.itemPrice+'</dd><dt class="hb-fl-desc" style="display:none;">\u8fd4\u5229:</dt><dd numiid="'+a.itemId+'" class="hb-fl" picid="'+b+'" style="display:none;"></dd><dt>\u7b80\u8ff0:</dt><dd>'+
a.itemDesc+'</dd></dl><div style="clear:both;"></div></div><div class="p4p-goods-tip"></div><b class="corner"></b></div>');j.append(x.append(y).append(a))}$(".marked-area",j).animate({opacity:0},2E3);$(".inner-border",j).hover(function(){C($(this).parent())},function(h){var s=$(this).parent();if(h.relatedTarget)if($.contains(s.parent().find(".tip-wrap")[0],h.relatedTarget))return;D(s)});$("dd",u).fadeIn("slow").unbind("hover").hover(function(){$(this).addClass("current").siblings().removeClass("current");
C($(".related-goods-marker[data-tipid="+$(this).attr("data-tipid")+"] .marked-area",j))},function(){$(this).removeClass("current");D($(".related-goods-marker[data-tipid="+$(this).attr("data-tipid")+"] .marked-area",j))});if(ISFANLI&&w.length>0)if(ISMEMBER){var E=$("#J_posterContainer").data("pic-"+b);E!=null?$(".hb-fl",j).each(function(){var h=E[$(this).attr("numiid")];h&&"0"!=h&&$(this).empty().append(h+"\u5143").show().parent().find(".hb-fl-desc").show()}):(new WindSender("/router/huabao/convert?v="+
Math.random(),true)).load("GET",{picid:b,numiids:w.join(",")},function(h){if(h.isSuccess()){var s=h.body.commissions;$("#J_posterContainer").data("pic-"+h.body.picid,h.body.commissions);$(".hb-fl",j).each(function(){var z=s[$(this).attr("numiid")];z&&"0"!=z&&$(this).empty().append(z+"\u5143").show().parent().find(".hb-fl-desc").show()})}})}else $(".hb-fl",j).each(function(){var h=$(this).attr("picid");$(this).empty().append('<a class="hb-fl-a" picid="'+h+'">\u9700\u767b\u5f55</a>').show().parent().find(".hb-fl-desc").show();
$(".hb-fl-a",$(this)).click(function(){openHuabaoLoginFanliDialog($(this).attr("picid"));return false})})}}).attr("src",f.picSrc)}}}function C(b){b.animate({opacity:1},500);b.parent().find(".tip-wrap").animate({opacity:1},500).css("z-Index",1).show()}function D(b){b.animate({opacity:0},1E3);b.parent().find(".tip-wrap").animate({opacity:0},1E3).css("z-Index",0).show()}var e,c,t,k,p=$("#J_thumbList ul"),F=$("#currentNum"),v=$("#thumbCurrent"),j=$("#J_posterOriginalImage"),B=$("#J_Image"),G=$("#J_PosterDesc"),
u=$("#related-goods"),l=parseInt($("#J_thumbList").height()/5);$.getJSON("/router/huabao/data/"+HID+"?v="+Math.random(),function(b){k=b;$("body").data("hbs",k);t=k.length;PICID!=0?o(PICID,true):o($("#J_thumbList ul li div img:first").attr("data-picid"));$("#J_thumbList li").click(function(){o($("div img:first",$(this)).attr("data-picid"));return false});$("#J_prevThumb").click(function(){c=c>5?c-5:0;p.animate({top:-1*c*l},500);v.animate({top:-1*(c-e)*l},500);return false});$("#J_nextThumb").click(function(){if(!(t-
c<=5)){c+=5;p.animate({top:-1*c*l},500);v.animate({top:-1*(c-e)*l},500);return false}});B.click(function(){if(e<t-1){e-c>=4&&p.animate({top:-1*(c+5)*l},500);o(k[e+1].picId)}return false});$("#J_prevPage").click(function(){if(e>0){e-c==0&&p.animate({top:-1*(c-5)*l},500);o(k[e-1].picId)}return false});$("#J_nextPage").click(function(){if(e<t-1){e-c>=4&&p.animate({top:-1*(c+5)*l},500);o(k[e+1].picId)}return false})});$("#J_RelateHuabaos").append('<div class="loading" align="left">\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u5019...</div>');
$.getJSON("/router/huabao/relate/"+HID+"?v="+Math.random(),function(b){var i='<ul class="poster-list-image clearfix">';if(b&&b.length>0)for(var f=0;f<b.length;f++){var d=b[f];i+='<li><div class="poster-pic-box thumb-wrap"><div class="wrap"><a href="/huabao/'+d.id+'.html"><img src="'+d.cover+'" alt="'+d.name+'"></a></div></div><span><a href="/huabao/'+d.id+'.html">'+d.shortName+"</a></span></li>"}else i+="\u65e0\u76f8\u5173\u753b\u62a5";i+="</ul>";$("#J_RelateHuabaos").empty().append(i)});$("#J_RandomHuabaos").append('<div class="loading" align="left">\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u5019...</div>');
$.getJSON("/router/huabao/random/"+HID+"?v="+Math.random(),function(b){var i='<ul class="poster-list-image clearfix">';if(b&&b.length>0)for(var f=0;f<b.length;f++){var d=b[f];i+='<li><div class="poster-pic-box thumb-wrap"><div class="wrap"><a href="/huabao/'+d.id+'.html"><img src="'+d.cover+'" alt="'+d.name+'"></a></div></div><span><a href="/huabao/'+d.id+'.html">'+d.shortName+"</a></span></li>"}else i+="\u65e0\u753b\u62a5";i+="</ul>";$("#J_RandomHuabaos").empty().append(i)})});