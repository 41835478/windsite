function initAdvanced(){$.tools.dateinput.localize("zh-CN",{months:"1\u6708,2\u6708,3\u6708,4\u6708,5\u6708,6\u6708,7\u6708,8\u6708,9\u6708,10\u6708,11\u6708,12\u6708",shortMonths:"1,2,3,4,5,6,7,8,9,10,11,12",days:"\u661f\u671f\u65e5,\u661f\u671f\u4e00,\u661f\u671f\u4e8c,\u661f\u671f\u4e09,\u661f\u671f\u56db,\u661f\u671f\u4e94,\u661f\u671f\u516d",shortDays:"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d"});$("#startDate,#endDate").dateinput({lang:"zh-CN",format:"yyyy-mm-dd"});$('input[type="checkbox"][name="dimensions"]').change(function(){switch($(this).val()){case "category":$(this).is(":checked")&&
$('input[type="checkbox"][name="dimensions"][value="label"]').attr("checked",true);break;case "label":$(this).is(":checked")||$('input[type="checkbox"][name="dimensions"][value="category"]').attr("checked",false);break}});$("#categoryFilterSelect").change(function(){$("#category-items").parent().find("select").hide();switch($(this).val()){case "item":$("#category-items").show();break;case "channel":$("#category-channels").show();break;case "blog":$("#category-blogs").show();break;case "activity":$("#category-activitys").show();
break}});$(".analytics").click(function(){var a=$(this).attr("name");if("source"==a){$('input[type="checkbox"][name="dimensions"]').each(function(){"source"==$(this).val()?$(this).attr("checked",true):$(this).attr("checked",false)});$("#categoryFilterSelect").val("0");advancedAnalytics(SID,NICK)}else if("city"==a){$('input[type="checkbox"][name="dimensions"]').each(function(){"city"==$(this).val()?$(this).attr("checked",true):$(this).attr("checked",false)});$("#categoryFilterSelect").val("0");advancedAnalytics(SID,
NICK)}else{$('input[type="checkbox"][name="dimensions"]').attr("checked",true);$("#categoryFilterSelect").val(a);advancedAnalytics(SID,NICK,1,"-ga:date")}return false})}
function advancedAnalytics(a,g,d,b,e){var f=[],h="";d||(d=1);$('input[type="checkbox"][name="dimensions"]:checked').each(function(){f.push($(this).val())});var c=$("#categoryFilterSelect").val();if(c!="0")if(e)h=c+":"+e;else h=(h=convertCategoryFilterValue(c))?c+":"+h:c+":0";c=$("#startDate").val();e=$("#endDate").val();if(!c||c.length==0)alert("\u672a\u6307\u5b9a\u5f00\u59cb\u65f6\u95f4");else!e||e.length==0?alert("\u672a\u6307\u5b9a\u7ed3\u675f\u65f6\u95f4"):getAdvancedAnalytics(a,g,d,c,e,f,h,b)}
function getAdvancedAnalytics(a,g,d,b,e,f,h,c){$("#tableProfile").empty().append("<tr id='loading'><td><div  align='left'>\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u5019...</div></td></tr>");$.ajax({url:"/router/member/ga/seller/advanced/"+a+"?v="+Math.random(),type:"POST",data:{nick:g,pageNo:d,startDate:b,endDate:e,dimensions:f.join(","),categoryFilter:h,sort:c?c:""},dataType:"html",beforeSend:function(i){i.setRequestHeader("WindType","AJAX");i.setRequestHeader("WindDataType","HTML")},error:function(i,
l,k){$("#loading").remove();alert(l)},success:function(i){$("#loading").remove();$("#tableProfile").empty().append(i);$("#tableProfile .page-number").click(function(){getAdvancedAnalytics(pid,$("a",$(this)).text(),b,e,f,h,c);return false});$("#tableProfile .pgNext").click(function(){$(this).hasClass("pgEmpty")||getAdvancedAnalytics(pid,$(this).attr("page"),b,e,f,h,c);return false})}})}
function convertCategoryFilterValue(a){switch(a){case "item":return $("#category-items").val();case "shop":return $("#category-shops").val()}}function createAnalytics(a,g,d,b,e){$("#"+a).empty();$("#"+a).append("<div id='loading' align='left'>\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u5019...</div>");g=g.indexOf("?")!=-1?g+"&ieversion="+Math.random():g+"?ieversion="+Math.random();(new WindSender(g)).load(d,b,function(f){$("#loading").remove();f.isSuccess()?e(f.body):alert(f.msg)})}
function createSellerProfile(a,g,d){createAnalytics(a,"/router/member/ga/seller/siteprofile/"+g,"POST",{nick:d},function(b){if(b.length==0)alert("\u672a\u67e5\u8be2\u5230\u8be5\u7ad9\u70b9\u6700\u8fd130\u5929\u63a8\u5e7f\u8d8b\u52bf");else{$("#"+a).empty();$.jqplot.config.enablePlugins=true;for(var e=[],f=[],h=0;h<b.length;h++){var c=b[h];e.push([c.date,c.pv]);f.push([c.date,c.uv])}$("#profileBody").empty().append('<tr class="odd"><td>\u4eca\u5929</td><td>'+b[0].pv+"</td><td>"+b[0].uv+"</td></tr>");
$("#profileBody").append("<tr><td>\u6628\u5929</td><td>"+b[1].pv+"</td><td>"+b[1].uv+"</td></tr>");$("#profileBody").append('<tr class="odd"><td>\u524d\u5929</td><td>'+b[2].pv+"</td><td>"+b[2].uv+"</td></tr>");$.jqplot(a,[e,f],{title:"\u6700\u8fd130\u5929\u63a8\u5e7f\u8d8b\u52bf",legend:{show:true,location:"n"},cursor:{showVerticalLine:true,showTooltip:true,followMouse:true,showTooltipDataPosition:true,zoom:true,intersectionThreshold:6,tooltipFormatString:"%s %s, %s"},series:[{label:"\u63a8\u5e7f\u70b9\u51fb\u6b21\u6570"},
{label:"\u552f\u4e00\u70b9\u51fb\u6b21\u6570"}],axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,min:b[b.length-1].date,max:b[0].date,tickInterval:"1 day",tickOptions:{formatString:""},numberTicks:5},highlighter:{sizeAdjust:10,tooltipLocation:"n",useAxesFormatters:false,formatString:"Hello %s dayglow %d"},yaxis:{tickOptions:{formatString:"%d"},min:0,numberTicks:10}}})}})}
function createHourProfile(a,g,d,b){$("#profileBody").empty();createAnalytics(a,"/router/member/ga/seller/hour/"+g,"POST",{nick:d,date:b},function(e){if(e.length==0)alert("\u672a\u67e5\u8be2\u5230\u65f6\u6bb5\u5206\u6790\u6570\u636e");else{$("#"+a).empty();$("#profileBody").empty();$.jqplot.config.enablePlugins=true;for(var f=[],h=[],c=0;c<e.length;c++){var i=e[c];$("#profileBody").append('<tr class="'+(c%2==0?"odd":"even")+'"><td>'+convertAnalyticsHour(i.hour)+"</td><td>"+i.pv+"</td><td>"+i.uv+"</td></tr>");
f.push([i.hour,i.pv]);h.push([i.hour,i.uv])}$.jqplot(a,[f,h],{title:b+":\u65f6\u6bb5\u5206\u6790",legend:{show:true,location:"n"},cursor:{showVerticalLine:true,showTooltip:true,followMouse:true,showTooltipDataPosition:true,zoom:true,intersectionThreshold:6,tooltipFormatString:"%s %s, %s"},series:[{label:"\u63a8\u5e7f\u70b9\u51fb\u6b21\u6570"},{label:"\u552f\u4e00\u70b9\u51fb\u6b21\u6570"}],axes:{xaxis:{min:0,max:23,tickInterval:1,tickOptions:{formatString:"%d"},numberTicks:24},highlighter:{sizeAdjust:10,
tooltipLocation:"n",useAxesFormatters:false},yaxis:{tickOptions:{formatString:"%d"},min:0,numberTicks:10}}})}})}
function createDayProfile(a,g,d,b,e,f,h){$("#profileBody").empty();createAnalytics(a,"/router/member/ga/seller/day/"+g,"POST",{nick:d,startDate:b,endDate:e,year:f,month:h},function(c){if(c.length==0)alert("\u672a\u67e5\u8be2\u5230\u6bcf\u65e5\u5206\u6790\u6570\u636e");else{$("#"+a).empty();$("#profileBody").empty();$.jqplot.config.enablePlugins=true;for(var i=[],l=[],k=0;k<c.length;k++){var j=c[k];$("#profileBody").append('<tr class="'+(k%2==0?"odd":"even")+'"><td>'+j.date+"</td><td>"+j.pv+"</td><td>"+
j.uv+"</td></tr>");i.push([j.date,j.pv]);l.push([j.date,j.uv])}$.jqplot(a,[i,l],{title:(b!=""?b+"\u81f3"+e:f+"-"+h)+":\u6bcf\u65e5\u5206\u6790",legend:{show:true,location:"n"},cursor:{showVerticalLine:true,showTooltip:true,followMouse:true,showTooltipDataPosition:true,zoom:true,intersectionThreshold:6,tooltipFormatString:"%s %s, %s"},series:[{label:"\u63a8\u5e7f\u70b9\u51fb\u6b21\u6570"},{label:"\u552f\u4e00\u70b9\u51fb\u6b21\u6570"}],axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,min:c[c.length-
1].date,max:c[0].date,tickInterval:"1 day",tickOptions:{formatString:""},numberTicks:c.length>5?5:c.length},highlighter:{sizeAdjust:10,tooltipLocation:"n",useAxesFormatters:false},yaxis:{tickOptions:{formatString:"%d"},min:0,numberTicks:10}}})}})}
function createLastVisitProfile(a,g,d){$("#"+a).empty();$("#"+a).append("<tr id='loading'><td colspan=5><div align='left'>\u6b63\u5728\u52a0\u8f7d\u6570\u636e,\u8bf7\u7a0d\u5019...</div></td></tr>");(new WindSender("/router/member/ga/seller/lastvisit/"+g+"?v="+Math.random())).load("POST",{nick:d},function(b){$("#loading").remove();if(b.isSuccess()){b=b.body;if(b.length==0)alert("\u672a\u67e5\u8be2\u5230\u3010"+d+"\u3011\u6700\u8fd1\u8bbf\u5ba2");else{$("#"+a).empty();for(var e=0;e<b.length;e++){var f=
b[e];$("#"+a).append('<tr class="'+(e%2==0?"odd":"even")+'"><td>'+f.date+"\t"+f.hour+'</td><td style="font-weight:bold;color:#00E;">'+convertAnalyticsAction(f.action)+'</td><td style="text-align:left;">'+convertAnalyticsLabel(f.action,f.label)+"</td><td>"+convertAnalyticsSource(f.source)+"</td><td>"+f.city+"</td></tr>")}}}else alert(b.msg)})}
function convertAnalyticsLabel(a,g){var d=a.split("-");return a.indexOf("item-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=item:'+d[d.length-1]+'">'+g+"</a>":a.indexOf("shop-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=shop:'+d[d.length-1]+'">'+g+"</a>":a.indexOf("channel-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=channel:'+
d[d.length-1]+'">'+g+"</a>":a.indexOf("key-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=key:'+d[d.length-1]+'">'+g+"</a>":a.indexOf("blog-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=blog:'+d[d.length-1]+'">'+g+"</a>":a.indexOf("activity-")!=-1?'<a style="color:#00e;" href="/router/member/analyticsmanager/seller/advanced?dimensions=date,category,label,city&categoryFilter=activity:'+
d[d.length-1]+'">'+g+"</a>":g}
function convertAnalyticsHour(a){switch(a){case "00":return"0:00-1:00";case "01":return"1:00-2:00";case "02":return"2:00-3:00";case "03":return"3:00-4:00";case "04":return"4:00-5:00";case "05":return"5:00-6:00";case "06":return"6:00-7:00";case "07":return"7:00-8:00";case "08":return"8:00-9:00";case "09":return"9:00-10:00";case "10":return"10:00-11:00";case "11":return"11:00-12:00";case "12":return"12:00-13:00";case "13":return"13:00-14:00";case "14":return"14:00-15:00";case "15":return"15:00-16:00";
case "16":return"16:00-17:00";case "17":return"17:00-18:00";case "18":return"18:00-19:00";case "19":return"19:00-20:00";case "20":return"20:00-21:00";case "21":return"21:00-22:00";case "22":return"22:00-23:00";case "23":return"23:00-24:00"}return a+":00-"+(parseInt(a)+1)+":00"}
function convertAnalyticsAction(a){return a.indexOf("item-")!=-1?"<span style='color:#FF4500;'>\u5546\u54c1\u63a8\u5e7f</span>":a.indexOf("shop-")!=-1?"<span style='color:#FF7F50;'>\u5e97\u94fa\u63a8\u5e7f</span>":a.indexOf("channel-")!=-1?"<span style='color:#FFA07A;'>\u9891\u9053\u63a8\u5e7f</span>":a.indexOf("key-")!=-1?"<span style='color:#A0522D;'>\u5173\u952e\u8bcd\u63a8\u5e7f</span>":a.indexOf("blog-")!=-1?"<span style='color:#8B4513;'>\u8f6f\u6587\u63a8\u5e7f</span>":a.indexOf("activity-")!=
-1?"<span style='color:#D2691E;'>\u6d3b\u52a8\u63a8\u5e7f</span>":"\u672a\u77e5"}function convertAnalyticsSource(a){return a&&a.length>0&&"(direct)"==a?"\u76f4\u63a5\u8bbf\u95ee":a};