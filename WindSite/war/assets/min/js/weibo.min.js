function initWeiboForm(a,b){b||(b=$("#weiboForm"));$(".btn-ok",b).hover(function(){$(this).removeClass("btn-ok-hover").addClass("btn-ok-hover")},function(){$(this).removeClass("btn-ok-hover")});$.tools.validator.localize("en",{"*":"\u8f93\u5165\u9519\u8bef",":email":"\u7535\u5b50\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e",":number":"\u8bf7\u8f93\u5165\u6570\u5b57",":url":"URL\u5730\u5740\u4e0d\u6b63\u786e","[max]":"\u8bf7\u8f93\u5165\u4e00\u4e2a\u5c0f\u4e8e $1\u7684\u6570\u5b57","[min]":"\u8bf7\u8f93\u5165\u4e00\u4e2a\u5927\u4e8e$1\u7684\u6570\u5b57",
"[required]":"\u5fc5\u586b\u9879"});$.tools.validator.fn("[minlength]",function(c,d){c=c.attr("minlength");return d.replace(/[^\x00-\xff]/g,"**").length>=c?true:{en:"\u8bf7\u81f3\u5c11\u586b\u5199 "+c+"\u4e2a\u5b57\u7b26\uff0c"+c/2+"\u4e2a\u6c49\u5b57"}});$.tools.validator.fn("[maxlength]",function(c,d){c=c.attr("maxlength");return d.replace(/[^\x00-\xff]/g,"**").length<=c?true:{en:"\u6700\u591a\u5141\u8bb8"+c+"\u4e2a\u5b57\u7b26\uff0c"+c/2+"\u4e2a\u6c49\u5b57"}});b.validator({position:"center right"}).submit(function(c){if($("#weiboForm .btn-ok",
$(this)).hasClass("btn-ok-disabled"))c.preventDefault();else if(c.isDefaultPrevented())$(".btn-ok",b).removeClass("btn-ok-disabled");else{$(".btn-ok",b).addClass("btn-ok-disabled");a();c.preventDefault()}})}
function initWeiboProfile(){initWeiboForm(function(){var a=$("#wb_logo").val();if(a){a=a.substring(a.length-3,a.length);if(a!="png"&&a!="PNG"){alert("\u60a8\u7684\u5fae\u535aLOGO\u5fc5\u987b\u4e3aPNG\u56fe\u7247");$("#wb_logo").focus();$("#weiboForm .btn-ok").removeClass("btn-ok-disabled");return}}(new WindSender("/router/member/fl/weibo/profile/update")).load("POST",{wb_site_title:$("#wb_site_title").val(),wb_skin_default:$("#wb_skin_default").val(),wb_site_info:$("#wb_site_info").val(),wb_site_record:$("#wb_site_record").val(),
wb_logo:$("#wb_logo").val(),wb_third_code:$("#wb_third_code").val(),wb_login_way:$('input[type="radio"][name="wb_login_way"]:checked').val()},function(b){b.isSuccess()?alert("\u4fee\u6539\u5fae\u535a\u57fa\u672c\u8bbe\u7f6e\u6210\u529f"):alert(b.msg);$("#weiboForm .btn-ok").removeClass("btn-ok-disabled")})})}
function initWeiboWbIndex(){$('input[type="radio"][name="wb_oper"]').change(function(){if($(this).val()=="1"){$("#wb_link").css("background","#EBEBE4").attr("readonly",true);$("#wb_topic").css("background","none").attr("readonly",false)}else{$("#wb_topic").css("background","#EBEBE4").attr("readonly",true);$("#wb_link").css("background","none").attr("readonly",false)}});initWeiboForm(function(){(new WindSender("/router/member/fl/weibo/wbindex/update")).load("POST",{wb_title:$("#wb_title").val(),wb_text:$("#wb_text").val(),
wb_topic:$("#wb_topic").val(),wb_link:$("#wb_link").val(),wb_btn_title:$("#wb_btn_title").val(),wb_oper:$('input[type="radio"][name="wb_oper"]:checked').val()},function(a){a.isSuccess()?alert("\u4fee\u6539\u5fae\u535a\u9996\u9875\u805a\u7126\u4f4d\u914d\u7f6e\u6210\u529f"):alert(a.msg);$("#weiboForm .btn-ok").removeClass("btn-ok-disabled")})})}
function initWeiboOpen(){var a=$("#addOpenWizard").scrollable().scrollable();a.onBeforeSeek(function(b,c){$("#status li").removeClass("active").eq(c).addClass("active");c==1&&$("#wb_app_key").val()});$("#appKeyType").click(function(){var b=$(this);if(b.text()=="\u7cfb\u7edf\u5206\u914d")confirm("\u60a8\u786e\u5b9a\u8981\u5207\u6362\u56de\u7cfb\u7edf\u5206\u914d\u7684\u5417\uff1f",function(c){if(c){b.text("\u81ea\u5b9a\u4e49");$("#wb_app_key,#wb_app_secret").attr("readonly",true).css("background",
"gray").val("\u7cfb\u7edf\u5206\u914d")}});else{b.text("\u7cfb\u7edf\u5206\u914d");$("#wb_app_key,#wb_app_secret").attr("readonly",false).css("background","none").val("")}});initWeiboForm(function(){(new WindSender("/router/member/fl/weibo/open/update")).load("POST",{wb_app_key:$("#wb_app_key").val(),wb_app_secret:$("#wb_app_secret").val(),wb_nick:$("#wb_nick").val()},function(b){if(b.isSuccess())if("\u7cfb\u7edf\u5206\u914d"==$("#wb_app_key").val())alert("\u4f7f\u7528\u7cfb\u7edf\u5206\u914d\u65b0\u6d6a\u5fae\u535a\u5f00\u653e\u5e73\u53f0\u4fe1\u606f\u6210\u529f\uff0c\u65e0\u9700\u8bbe\u7f6e\u7ba1\u7406\u5458");
else{alert("\u4f7f\u7528\u81ea\u5df1\u7684\u65b0\u6d6a\u5fae\u535a\u5f00\u653e\u5e73\u53f0\u4fe1\u606f\u6210\u529f\uff0c\u5fc5\u9700\u8bbe\u7f6e\u7ba1\u7406\u5458");a.next()}else alert(b.msg);$("#weiboFirstForm .btn-ok").removeClass("btn-ok-disabled")})},$("#weiboFirstForm"));initWeiboForm(function(){if("\u7cfb\u7edf\u5206\u914d"!=$("#wb_app_key").val())if(!$("#wb_nick").val()){alert("\u4f7f\u7528\u81ea\u5df1\u7684App Key,\u5fc5\u987b\u6307\u5b9a\u7ba1\u7406\u5458\u6635\u79f0");return}(new WindSender("/router/member/fl/weibo/open/update")).load("POST",
{wb_app_key:$("#wb_app_key").val(),wb_app_secret:$("#wb_app_secret").val(),wb_nick:$("#wb_nick").val()},function(b){b.isSuccess()?alert("\u8bbe\u7f6e\u5fae\u535a\u7ba1\u7406\u5458\u6210\u529f"):alert(b.msg);$("#weiboSecondForm .btn-ok").removeClass("btn-ok-disabled")})},$("#weiboSecondForm"))}
function initWeiboAd(){initWeiboForm(function(){(new WindSender("/router/member/fl/weibo/weiboad/update")).load("POST",{wb_ad_footer:$("#wb_ad_footer").val()},function(a){a.isSuccess()?alert("\u4fee\u6539\u5fae\u535a\u5e7f\u544a\u6210\u529f"):alert(a.msg);$("#weiboForm .btn-ok").removeClass("btn-ok-disabled")})})}
function initWeiboLinks(){$("#links .links-head").click(function(){var a=$(".ui-icon",$(this));if(a.hasClass("ui-icon-minusthick")){$(this).parent().find(".links-body").fadeOut();a.removeClass("ui-icon-minusthick").addClass("ui-icon-plusthick")}else{$(this).parent().find(".links-body").fadeIn();a.removeClass("ui-icon-plusthick").addClass("ui-icon-minusthick")}});$("#wb-profile-link-create").click(function(a){if($("#wb-profile-links tr.wb-link-row").length>5){alert("\u60a8\u5df2\u7ecf\u6dfb\u52a0\u4e865\u4e2a\u9876\u90e8\u94fe\u63a5");
a.preventDefault();return false}var b=$('<tr class="wb-link-row"><td width=200px><input class="i-text wb-link-name" /></td><td width=400px><input class="i-text wb-link-address" /></td><td><a class="delete-link">\u5220\u9664</a></td></tr>');$("#wb-profile-links").append(b);$(".delete-link",b).click(function(){$(this).parents("tr.wb-link-row").remove()});a.preventDefault();return false});$("#wb-top-link-create").click(function(a){if($("#wb-top-links tr.wb-link-row").length>5){alert("\u60a8\u5df2\u7ecf\u6dfb\u52a0\u4e865\u4e2a\u9876\u90e8\u94fe\u63a5");
a.preventDefault();return false}var b=$('<tr class="wb-link-row"><td width=200px><input class="i-text wb-link-name" /></td><td width=400px><input class="i-text wb-link-address" /></td><td><a class="delete-link">\u5220\u9664</a></td></tr>');$("#wb-top-links").append(b);$(".delete-link",b).click(function(){$(this).parents("tr.wb-link-row").remove()});a.preventDefault();return false});$("#wb-bottom-link-create").click(function(a){if($("#wb-bottom-links tr.wb-link-row").length>10){alert("\u60a8\u5df2\u7ecf\u6dfb\u52a0\u4e8610\u4e2a\u9876\u90e8\u94fe\u63a5");
a.preventDefault();return false}var b=$('<tr class="wb-link-row"><td width=200px><input class="i-text wb-link-name" /></td><td width=400px><input class="i-text wb-link-address" /></td><td><a class="delete-link">\u5220\u9664</a></td></tr>');$("#wb-bottom-links").append(b);$(".delete-link",b).click(function(){$(this).parents("tr.wb-link-row").remove()});a.preventDefault();return false});$("a.delete-link").click(function(){var a=$(this);confirm("\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u94fe\u63a5\u5417\uff1f",
function(b){if(b){a.parents("tr.wb-link-row").remove();$('.wb-link-confirm[t="'+a.attr("t")+'"]').click()}})});$(".wb-link-confirm").hover(function(){$(this).removeClass("btn-ok-hover").addClass("btn-ok-hover")},function(){$(this).removeClass("btn-ok-hover")}).click(function(){weiboLinksUpdate($(this))})}
function weiboLinksUpdate(a){var b=a.attr("t"),c=false,d=[],g=1;$("#wb-"+b+"-links tr.wb-link-row").each(function(){var e=$(this).find(".wb-link-name"),f=$(this).find(".wb-link-address"),i=/\"/g;if(e.val())e.val(e.val().replace(i,""));else{alert("\u94fe\u63a5\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a");c=true;e.focus();return false}if(f.val())f.val(f.val().replace(i,""));else{alert("\u94fe\u63a5\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");c=true;f.focus();return false}b=="profile"?d.push('{"title":"'+e.val()+
'","link":"'+f.val()+'"}'):d.push('"'+g+'":{"link_name":"'+e.val()+'","link_address":"'+f.val()+'"}');g++});if(c)a.removeClass("btn-ok-disabled");else{var h="[]";if(d.length>0)h=b=="profile"?"["+d.join(",")+"]":"{"+d.join(",")+"}";a.addClass("btn-ok-disabled");if("top"==b)confirmWeiboLinksUpdate(a,h,"","");else if("bottom"==b)confirmWeiboLinksUpdate(a,"",h,"");else"profile"==b&&confirmWeiboLinksUpdate(a,"","",h)}}
function confirmWeiboLinksUpdate(a,b,c,d){(new WindSender("/router/member/fl/weibo/links/update")).load("POST",{wb_head_link:b,wb_foot_link:c,wb_profile_link:d},function(g){if(g.isSuccess()){alert("\u4fee\u6539\u5fae\u535a\u94fe\u63a5\u914d\u7f6e\u6210\u529f");document.location.href="/router/member/fl/weibo/links"}else alert(g.msg);a.removeClass("btn-ok-disabled")})};